(function(){var e=null,t=null,n=null,r=function(e){return e.title==="Targetprocess Screen Capture"&&e.url.match(/^chrome-extension:\/\//)},i=function(){return new Promise(function(e){chrome.tabs.captureVisibleTab(null,e)})},s=function(e){t=e;var r=chrome.extension.getURL("editor.html?id="+Number(new Date));chrome.tabs.create({url:r},function(e){n=e})},o=function(e){r(e)||i().then(function(e){s(e)})},u=function(e){chrome.tabs.sendMessage(e.id,{action:"captureSelection:start"})};chrome.runtime.onMessage.addListener(function(r,i){switch(r.action){case"captureVisible:selected":chrome.tabs.query({active:!0,currentWindow:!0},function(e){o(e[0])});break;case"captureSelection:selected":chrome.tabs.query({active:!0,currentWindow:!0},function(e){u(e[0])});break;case"captureSelection:completed":e=r.selection,o(i.tab);break;case"editor:ready":n&&t&&i.tab.id===n.id?(chrome.tabs.sendMessage(i.tab.id,{action:"editor:startExternal",image:t,selection:e}),n=null,e=null,t=null):chrome.tabs.sendMessage(i.tab.id,{action:"editor:startLocal"})}});var a=function(e){chrome.tabs.get(e,function(e){e&&(r(e)?chrome.browserAction.disable():chrome.browserAction.enable())})};chrome.tabs.onUpdated.addListener(function(e){return a(e)}),chrome.tabs.onActivated.addListener(function(e){return a(e.tabId)}),chrome.windows.onFocusChanged.addListener(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){a(e[0].id)})})})();